<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2011 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<div class="page-title">
    <h1><?php echo $this->__('Checkout') ?></h1>
</div>
<script type="text/javascript" src="<?php echo $this->getJsUrl('varien/accordion.js') ?>"></script>
<script type="text/javascript" src="<?php echo $this->getSkinUrl('js/opcheckout.js') ?>"></script>
<script type="text/javascript">countryRegions = <?php echo $this->helper('directory')->getRegionJson() ?></script>
<ol class="opc" agnew="yes" id="checkoutSteps">
<?php

// this checks if it is a downloadable product first, limits to 40 if so, unlimited quantity for physical products
 if($this->getQuote()->isVirtual()) {
            $total = $this->helper('checkout/cart')->getSummaryCount();
        } else {
            $total = 0;
        };

//$total = $this->helper('checkout/cart')->getSummaryCount();
$totalp = $this->helper('checkout/cart')->getQuote()->getGrandTotal();
//get total price
 if($total>=40 || $totalp>=20000.00){ ?>
 
<?  if($totalp>=20000.00){ ?>
<h3>You have exceeded the maximum cart total of $20000.00.<br />
<br />
 <a href="/checkout/cart/">For large orders, please call us at: 866.977.3435.</a></h3>
<? } else { ?>
<h3>You have exceeded the maximum amount of items (40).<br />
<br />
 <a href="/checkout/cart/">Please visit your cart here to remove items.</a></h3>
 <? } ?>
<?php } else { ?>


<?php $i=0; foreach($this->getSteps() as $_stepId => $_stepInfo): ?>
<?php if (!$this->getChild($_stepId) || !$this->getChild($_stepId)->isShow()): continue; endif; $i++ ?>
    <li id="opc-<?php echo $_stepId ?>" class="section<?php echo !empty($_stepInfo['allow'])?' allow':'' ?><?php echo !empty($_stepInfo['complete'])?' saved':'' ?>">
        <div class="step-title">
            <span class="number"><?php echo $i ?></span>
            <h2><?php echo $_stepInfo['label'] ?></h2>
            <a href="#"><?php echo $this->__('Edit') ?></a>
        </div>
        <div id="checkout-step-<?php echo $_stepId ?>" class="step a-item" style="display:none;">
            <?php echo $this->getChildHtml($_stepId) ?>
        </div>
    </li>
 
    
<?php endforeach ?>


<?php } ?>
</ol>

<script type="text/javascript">
//<![CDATA[
    var accordion = new Accordion('checkoutSteps', '.step-title', true);
    <?php if($this->getActiveStep()): ?>
    accordion.openSection('opc-<?php echo $this->getActiveStep() ?>');
    <?php endif ?>
    var checkout = new Checkout(accordion,{
        progress: '<?php echo $this->getUrl('checkout/onepage/progress') ?>',
        review: '<?php echo $this->getUrl('checkout/onepage/review') ?>',
        saveMethod: '<?php echo $this->getUrl('checkout/onepage/saveMethod') ?>',
        failure: '<?php echo $this->getUrl('checkout/cart') ?>'}
    );
//]]>
</script>
<div><br />
<strong>Checkout processing could take up to a couple minutes, please be patient.</strong><br />
 If you are returned to your shopping cart and not an order confirmation page, please call us at <strong>866.977.3435</strong>. Thank you. 
 <div id="agdisclaimers"><br /><br />
<h3> Disclaimers: </h3>
  <ul style="font-size:11px;">
    <li>You have the right to cancel your order for a full refund at any time prior to your order being processed for shipping. Once the order has been processed you must follow our return policy. If you wish to cancel your order before it processes, we encourage you to call us toll-free at 1-866-977-3435.<br />
    </li>
    <li>Orders can be placed on our website 24 hours a day, 7 days a week, but orders will only be shipped out during standard business hours 8:00a.m.-5:00p.m. EST Monday-Friday, excluding scheduled business and holiday closings.<br />
    </li>
    <li>Orders placed Monday-Friday before 2:00p.m. EST will ship out same business day.<br />
    </li>
    <li>We currently do NOT ship to addresses outside of the continental United States.<br />
    </li>
    <li>If you are a current PreGel customer, please contact your Sales Representative or Key Account Specialist to place your order, no discounts will be given online.<br />
    </li>
    <li>A product and an image cannot be ordered at the same time. If you wish to place an image download and buy a product you must place two separate orders.<br />
    </li>
    <li>If you come across a product you want that is out of stock, please contact us toll-free at 1-866-977-3435 or email us at <a href="mailto:support@pregelmarketplace.com">support@pregelmarketplace.com</a> and we will let you know when we expect the item back in stock.<br />
    </li>
    <li>Our eCommerce system will only allow for purchases that can be sent standard UPS shipping. If your order amount exceeds those limits, you will need to contact us directly to arrange an LTL shipment. Any orders that is less than 7 cases or less than 150 lbs. per package can ship UPS, all other orders must be shipped LTL. Please call us toll-free at 1-866-977-3435 to arrange an LTL shipment.</li>
  </ul>
</div>
<?php 
/* Check if the customer is logged in or not */
if (Mage::getSingleton('customer/session')->isLoggedIn()) {
 
    /* Get the customer data */
    $customer = Mage::getSingleton('customer/session')->getCustomer();
    $fullname = $customer->getName();
    $email = $customer->getEmail();
	include('browser.php');
	$browser = new Browser();

$lastOrderId = Mage::getModel('sales/order')->getCollection()
      ->addFieldToFilter('increment_id', $increment_id)
      ->getFirstItem();

	//$lastOrderId = $lastOrderId + 1;	
	echo "<form id='sideemail'><textarea name='orderdetails' id='cinfo' style='display:none;'>";
	if(isset($fullname)){
	echo $fullname. " " . $email. "\n\n"; }else { echo "NEW CUSTOMER CHECKOUT"; }
	
	echo " ORDER ID: ". $lastOrderId . "\n\n". "Browser:  ".$browser->getBrowser() . " Browser Version:" . $browser->getVersion(). "\n\n" . "IP Address: " . $_SERVER['REMOTE_ADDR'];
	
	
	
$quote = Mage::getSingleton('checkout/session')->getQuote();

$items = $quote->getAllVisibleItems();

foreach($items as $cartItem) {
	echo "\n\n Item: ";
	echo $cartItem->getID() . " ";
    echo $cartItem->getName();
	
}
	echo "</textarea></form>";
}
?>
</div>